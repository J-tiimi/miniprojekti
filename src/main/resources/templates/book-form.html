<!DOCTYPE html>

<html xmlns:th="http://www.thymeleaf.org">

<body>

<div th:fragment="form">
    <h2>Add book reference</h2>

    <form id="book-form" onsubmit="submitBookForm()">
        <div>
            <label>Identifier</label>
            <input type="text" name="identifier" id="identifier"/>
        </div>
        
        <div>
            <label>Author</label>
            <input type="text" name="author" id="author"/>
        </div>
        
        <div>
            <label>Title</label>
            <input type="text" name="title" id="title"/>
        </div>
        
        <div>
            <label>Year</label>
            <input type="text" name="year" id="year"/>
        </div>
        
        <div>
            <label>Publisher</label>
            <input type="text" name="publisher" id="publisher"/>
        </div>
        
        <div>
            <button type="submit">Submit</button>
        </div>
    </form>

    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script>

        function submitBookForm() {
            var formData = buildJSONRequest();

            $.ajax({
                type: 'POST',
                url: '/reference',
                data: formData,
                contentType: 'application/json'
            });
        }

        function buildJSONRequest() {
            var body = {
                type: 'book',
                identifier: getInputValue('identifier'),
                attributes: [
                    {key: "author", value: getInputValue('author')},
                    {key: "title", value: getInputValue('title')},
                    {key: "publisher", value:getInputValue('publisher')},
                    {key: "year", value: getInputValue('year')}
                ]
            };

            return JSON.stringify(body);
        }

        function getInputValue(id) {
            return $('#book-form > #' + id).val();
        }

    </script>
</div>

</body>

</html>
